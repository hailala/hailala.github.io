(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{472:function(s,a,t){s.exports=t.p+"assets/img/img.202b68d5.png"},502:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",[s._v("关于前端项目使用iframe组件内嵌第三方系统的处理")]),s._v(" "),a("h2",{attrs:{id:"一、iframe组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、iframe组件"}},[s._v("#")]),s._v(" 一、iframe组件")]),s._v(" "),a("h3",{attrs:{id:"_1、基本语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本语法"}},[s._v("#")]),s._v(" 1、基本语法")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"URL"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2、常用属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、常用属性"}},[s._v("#")]),s._v(" 2、常用属性")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("属性")]),s._v(" "),a("th",[s._v("说明")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("name")]),s._v(" "),a("td",[s._v("规定 frame 的名称")])]),s._v(" "),a("tr",[a("td",[s._v("width")]),s._v(" "),a("td",[s._v("设置 frame 的宽度")])]),s._v(" "),a("tr",[a("td",[s._v("height")]),s._v(" "),a("td",[s._v("设置 frame 的高度")])]),s._v(" "),a("tr",[a("td",[s._v("src")]),s._v(" "),a("td",[s._v("设置在 frame 中显示的页面")])]),s._v(" "),a("tr",[a("td",[s._v("frameborder")]),s._v(" "),a("td",[s._v("是否显示 frame 的边框（0：不显示边框 1：显示边框）")])]),s._v(" "),a("tr",[a("td",[s._v("scrolling")]),s._v(" "),a("td",[s._v("是否显示 frame 中的滚动条（ yes|no|auto)")])])])]),s._v(" "),a("h3",{attrs:{id:"_3、基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、基本使用"}},[s._v("#")]),s._v(" 3、基本使用")]),s._v(" "),a("ul",[a("li",[s._v("代码")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe width"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100%"')]),s._v(" height"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200px"')]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hailala.github.io/"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("效果")])]),s._v(" "),a("iframe",{attrs:{width:"100%",height:"200px",src:"https://hailala.github.io/"}}),s._v(" "),a("h2",{attrs:{id:"二、使用postmessage进行组件间通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、使用postmessage进行组件间通信"}},[s._v("#")]),s._v(" 二、使用postMessage进行组件间通信")]),s._v(" "),a("h3",{attrs:{id:"_1、postmessage语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、postmessage语法"}},[s._v("#")]),s._v(" 1、postMessage语法：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("targetWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" targetOrigin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("transfer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("targetWindow:")])]),s._v(" "),a("p",[s._v("目标窗口的引用，比如执行"),a("code",[s._v("window.open")]),s._v("返回的窗口对象、打开当前窗口的引用"),a("code",[s._v("window.opener")]),s._v("、iframe的"),a("code",[s._v("contentWindow")]),s._v("属性，或者是命名过或数值索引的"),a("code",[s._v("window.frames")])]),s._v(" "),a("p",[a("strong",[s._v("message:")])]),s._v(" "),a("p",[s._v("发送给目标window的数据")]),s._v(" "),a("p",[a("strong",[s._v("targetOrigin:")])]),s._v(" "),a("p",[s._v('指定接收消息事件的窗口，其值可以是一个URI或者字符串**"*"**（表示无限制）')]),s._v(" "),a("p",[s._v("如果你明确的知道消息应该发送到哪个窗口，那么请始终提供一个有确切值的targetOrigin，而不是*。不提供确切的目标将导致数据泄露到任何对数据感兴趣的恶意站点。")]),s._v(" "),a("p",[a("strong",[s._v("transfer")]),s._v(": 可选")]),s._v(" "),a("p",[s._v("是一串和message 同时传递的 "),a("code",[s._v("Transferable")]),s._v("对象. 这些对象的所有权将被转移给消息的接收方，而发送一方将不再保有所有权。")]),s._v(" "),a("h3",{attrs:{id:"_2、在iframe组件里的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、在iframe组件里的使用"}},[s._v("#")]),s._v(" 2、在iframe组件里的使用")]),s._v(" "),a("p",[a("strong",[s._v("父传子")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// A.html （父）")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:5501/B.html"')]),s._v(" frameborder"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bframe"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onload")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" frame "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  frame"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:5501"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// B.html")]),s._v("\n window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("strong",[s._v("子传父")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// A.html （父）")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("iframe src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:5501/B.html"')]),s._v(" frameborder"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bframe"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("iframe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// B.html")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"B"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:5500"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"三、a系统内嵌b系统案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、a系统内嵌b系统案例"}},[s._v("#")]),s._v(" 三、A系统内嵌B系统案例")]),s._v(" "),a("h3",{attrs:{id:"_1、介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、介绍"}},[s._v("#")]),s._v(" 1、介绍")]),s._v(" "),a("p",[s._v("​\t\tA系统迁移基础数据部分页面至B页面，A系统通过内嵌B系统页面保留原功能，A系统前端为JSP页面，B系统为前端为VUE页面，即实现JSP页面内嵌VUE页面。")]),s._v(" "),a("h3",{attrs:{id:"_2、问题描述以及处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、问题描述以及处理"}},[s._v("#")]),s._v(" 2、问题描述以及处理")]),s._v(" "),a("p",[a("strong",[s._v("描述")]),s._v("：")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("两个系统无法做到同源策略（保证ip或域名和端口一致）。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("chrome浏览器iframe嵌套页面跨域存在无法获取cookie问题。")])]),s._v(" "),a("p",[a("strong",[s._v("原因")]),s._v("：Google 在2020年2月4号发布的 Chrome 80 版本中默认屏蔽所有第三方 Cookie，即默认为所有 Cookie 加上"),a("code",[s._v("SameSite=Lax")]),s._v("属性，并且拒绝非Secure的Cookie设为"),a("code",[s._v("SameSite=None")]),s._v("，SameSite的作用就是防止跨域传送cookie，从而防止 CSRF 攻击和用户追踪，此举是为了从源头屏蔽 CSRF 漏洞。Cookie 的SameSite属性用来限制第三方 Cookie，从而减少安全风险。")]),s._v(" "),a("blockquote",[a("p",[a("em",[s._v("SameSite的三个属性：")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Strict")]),s._v(" "),a("p",[a("code",[s._v("Strict")]),s._v("最为严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie。换言之，只有当前网页的 URL 与请求目标一致，才会带上 Cookie。")])]),s._v(" "),a("li",[a("p",[s._v("Lax")]),s._v(" "),a("p",[a("code",[s._v("Lax")]),s._v("规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外。")])]),s._v(" "),a("li",[a("p",[s._v("None")]),s._v(" "),a("p",[s._v("Chrome 计划将"),a("code",[s._v("Lax")]),s._v("变为默认设置。这时，网站可以选择显式关闭"),a("code",[s._v("SameSite")]),s._v("属性，将其设为"),a("code",[s._v("None")]),s._v("。不过，前提是必须同时设置"),a("code",[s._v("Secure")]),s._v("属性（"),a("strong",[s._v("Cookie 只能通过 HTTPS 协议发送")]),s._v("），否则无效。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("Set"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Cookie"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SameSite"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("None"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Secure\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])])]),s._v(" "),a("p",[a("strong",[s._v("在当前系统访问第三方系统时，cookie操作会被这个SameSite机制拦截掉了。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("当B系统和A系统同时进行登录时，系统如何识别。")])])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("如何确定"),a("code",[s._v("layout")]),s._v("配置。")])])])]),s._v(" "),a("p",[a("strong",[s._v("处理")]),s._v("：")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("A系统中在登录后的全局页面使用iframe内嵌B系统,并通过"),a("code",[s._v("postMessage")]),s._v("向B系统传递登录信号以及参数。")])]),s._v(" "),a("li",[a("strong",[s._v("在B系统中捕获来自A系统父页面的登录信号，根据登录参数调用登录接口。")])]),s._v(" "),a("li",[a("strong",[s._v("将登录接口返回的TOKEN信息存储在"),a("code",[s._v("localStorage")]),s._v("中")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("通过"),a("code",[s._v("window.self === window.top")]),s._v("判断"),a("code",[s._v("iframe")]),s._v("是否内嵌。")])])]),s._v(" "),a("p",[a("em",[a("strong",[a("font",{attrs:{color:"#dd00000"}},[s._v("关于iframe嵌套页面跨域无法获取cookie问题的补充:")])],1)])]),s._v(" "),a("ul",[a("li",[s._v("禁用浏览器samsite属性/或降低版本(目前仅chorme存在)")]),s._v(" "),a("li",[s._v("保证同源策略cookie共享(保证ip或域名一致)")]),s._v(" "),a("li",[s._v("设置"),a("code",[s._v("response.setHeader“Set-Cookie”“HttpOnly;SecureSameSite=None”")]),s._v("，需设置https证书")]),s._v(" "),a("li",[s._v("不使用cookie共享会话，使用token实现")])]),s._v(" "),a("h3",{attrs:{id:"_3、案例中的具体实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、案例中的具体实现"}},[s._v("#")]),s._v(" 3、案例中的具体实现")]),s._v(" "),a("p",[a("strong",[s._v("A系统部分：")])]),s._v(" "),a("div",{staticClass:"language-jsp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('// sysIndex.jsp\n<iframe id="riskIframe" src="">\n    \n<script type="text/javascript">\n    $(document).ready(function() {\n    \t//发送登录信号\n    \tloginRisk();\n    \t//监听来自B系统的消息\n   \t\twindow.addEventListener(\'message\',(e)=>{\n        \tif(e.data && e.data.type === \'riskData\'){\n            \t//根据返回消息判断，重新发送登录信息\n            \tloginRisk();\n        \t}\n    \t})\n\t})\n\n\t// 发送登录信号\n\tfunction loginRisk(){\n        window.onload = function(){\n            var A系统Data = {\n                type:"A系统Data",\n                password:"",\n                username:"",\n                path:"/"\n            }\n            var iframe = document.getElementById(\'riskIframe\');\n            iframe.contentWindow.postMessage(A系统Data,\'*\');\n        }\n    }\n    \n<\/script>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("strong",[s._v("B系统部分")])]),s._v(" "),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[s._v('//App.vue\nmounted(){\n    window.addEventListener("message",e =>{\n        // 判断来自A系统的消息\n        if(e.data && e.data.type === \'A系统Data\'){\n            var data = e.data;\n            // 处理登录信息\n            var loginForm = {\n                password:data.password,\n                username:data.username,\n                validataCode:"",\n                validataKey:""\n            };\n            this.$store.dispatch("LoginA系统ByUsername",loginForm).then(res=>{\n                console.log("登录B系统成功！");\n            })\n        }\n    })\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("div",{staticClass:"language-vue line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vue"}},[a("code",[s._v('//user.js\naction:{\n    //A系统用户登录\n    LoginByUsername({commit,dispatch},userInf0){\n        return new Promise((res,rej)=>{\n            var data = {\n                password:userInfo.password,\n                username:userInfo.username,\n                validataCode:userInfo.validataCode,\n                validataKey:userInfo.validataKey\n            };\n            login(data).then(res=>{\n                //B系统用户使用cookie存储登录接口返回的token\n                //A系统用户使用localStorage存储登录接口返回的token\n                window.localStorage.setItem("Admin-Token","token");\n                // ... 其他处理\n            })\n        })\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//util.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 判断当前是否为B系统用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// true为B系统用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// false为A系统用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRiskSystem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("self "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[a("em",[a("strong",[s._v("util.js中isRiskSystem()的作用：")])])]),s._v(" "),a("ul",[a("li",[s._v("通过该方法判断"),a("code",[s._v("iframe")]),s._v("是否内嵌确定后台接口所需TOKEN是从"),a("code",[s._v("Cookies")]),s._v("中获取还是从"),a("code",[s._v("localStorage")]),s._v("中获取。")]),s._v(" "),a("li",[s._v("通过该方法判断"),a("code",[s._v("iframe")]),s._v("是否内嵌确定系统"),a("code",[s._v("layout")]),s._v("配置。")])])]),s._v(" "),a("h3",{attrs:{id:"_4、其他问题及处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、其他问题及处理"}},[s._v("#")]),s._v(" 4、其他问题及处理")]),s._v(" "),a("img",{staticStyle:{zoom:"150%"},attrs:{src:t(472),alt:"typedata"}}),s._v(" "),a("p",[a("strong",[s._v("问题分析")]),s._v("：A系统使用iframe内嵌B系统VUE页面后，全局会新增一个跨域的"),a("code",[s._v("iframeDOM")]),s._v(",在A系统的其他功能中，涉及通过jquery的"),a("code",[s._v("jQuery.each.contants")]),s._v("属性遍历全局"),a("code",[s._v("iframeDOM")]),s._v(",找到对应"),a("code",[s._v("iframeDOM")]),s._v("操作时会出现该问题。原因在于遍历全局"),a("code",[s._v("iframeDOM")]),s._v("找到对应"),a("code",[s._v("iframeDOM")]),s._v("进行操作，遍历到跨域的"),a("code",[s._v("iframeDOM")]),s._v("时，该操作属于A系统父页面操作B系统子页面，涉及跨域操作，因此报错。")]),s._v(" "),a("p",[a("strong",[s._v("解决办法")]),s._v("：跨域的"),a("code",[s._v("iframeDOM")]),s._v("的id属性均定义为"),a("code",[s._v("riskIframe")]),s._v(",在jquerry的"),a("code",[s._v("jQuery.each.contants")]),s._v("属性里使用"),a("code",[s._v("elem.id !== 'riskIframe'")]),s._v("过滤掉跨域节点。")]),s._v(" "),a("h2",{attrs:{id:"四、总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、总结"}},[s._v("#")]),s._v(" 四、总结")]),s._v(" "),a("p",[s._v("虽然 iframe 标签可以很方便地实现系统内嵌，但是需要注意以下几点：")]),s._v(" "),a("ul",[a("li",[s._v("嵌入的网页必须与主页面保证同源策略，否则会受到浏览器的安全限制。")]),s._v(" "),a("li",[s._v("嵌入的网页可能会影响页面性能和加载速度，特别是当嵌入的网页包含大量的资源（如图片、CSS 和 JavaScript）时。")]),s._v(" "),a("li",[s._v("嵌入的网页可能会被恶意攻击者用于钓鱼或注入恶意代码的攻击，因此需要谨慎使用。")])]),s._v(" "),a("p",[s._v("总之，在使用 iframe 标签时，需要仔细权衡其优缺点，确保安全和性能。")])])}),[],!1,null,null,null);a.default=e.exports}}]);